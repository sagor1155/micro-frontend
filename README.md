# Micro-Frontend (MFE)
Micro-frontend Demo Project in Angular

## Topic List
- Load remote module/component using "webpack module federation"
- Load remote component from HTML
- Input/Output binding with remote component using "ngx-mfe"
- Communication between MFE using CustomEvent
- Communication between MFE using Shared Service and RxJs
- MFE using web components (@angular/elements)
- Load remote MFE from another MFE
- Sharing code and resources
  - library/services
  - style
  - config
  - version mismatch issue
- Passing Injector to MFE, Why & when do we need this? 
- Router snapshot/navigate behaviour within Shell (Host) & MFE
- Config based remote module loading from Shell
- Necessary libraries
  - Webpack module federation
  - ngx-mfe
  - angular/elements
  - nx
  - elementjs
  - single-spa
- Mono repo vs Separate repo
- References


## Load remote module/component using "webpack module federation"
Ref - https://github.com/angular-architects/module-federation-plugin/blob/main/libs/mf/tutorial/tutorial.md
### Project setup
- #### Create workspace
    `ng n micro-frontend-demo --create-application false`

- #### Go to workspace directory
    `cd micro-frontend-demo`

- #### Create shell (host) application
    `ng generate application shell --routing`

- #### Add component into shell (host) application
    `ng g c landingpage --project=shell`

- #### Create MFE application
    `ng generate application products --routing`

- #### Add module into MFE application
    `ng g module dashboard --routing --project=products`

    `ng g module catalog --routing --project=products`

- #### Add component into MFE application
    `ng g c dashboard/dashboard --project=products`

    `ng g c catalog/catalog --project=products`

- #### Install and activate module federation library into the Shell
    `ng add @angular-architects/module-federation --project shell --type host --port 4200`

- #### Install and activate module federation library into the MFE
    `ng add @angular-architects/module-federation --project products --type remote --port 3000`

### Configure module federation in remote MFE
- Go to project 'products', open `webpack.config.js` and configure like following
  
  ```js
  const { 
    withModuleFederationPlugin,
    share 
  } = require('@angular-architects/module-federation/webpack');

  module.exports = withModuleFederationPlugin({
    name: 'products',
    filename: 'products.js',
    exposes: {
        DashboardModule: './projects/products/src/app/dashboard/dashboard.module.ts',
        DashboardComponent: './projects/products/src/app/dashboard/dashboard/dashboard.component.ts',
        CatalogModule: './projects/products/src/app/catalog/catalog.module.ts',
        CatalogComponent: './projects/products/src/app/catalog/catalog/catalog.component.ts'
    },
    shared: share({
        '@angular/animations': {singleton: true, strictVersion: true},
        '@angular/core': {singleton: true, strictVersion: true},
        '@angular/common': {singleton: true, strictVersion: true},
        '@angular/forms': {singleton: true, strictVersion: true},
        '@angular/platform-browser': {singleton: true, strictVersion: true},
        '@angular/router': {singleton: true, strictVersion: true},
        'rxjs': {singleton: true, strictVersion: true, requiredVersion: false}
    })
  });
  ```

  Here,
  - `name` is the scope name which should be unique for a specific MFE.
  - `filename` is the file generated by webpack.
  - On `exposes` section add the module/component name and path which we want to expose. These modules/components will be available to be loaded remotely from Host or, another MFE. 
  - Libraries added on `shared` section will be shared among Host and MFEs. So, the MFEs bundle will not include these libraries, thus it will reduce the bundle size. 

  
### Configure module federation in Host
- Go to project 'shell', open `webpack.config.js` and configure like following
  
  ```js
  const { 
    withModuleFederationPlugin,
    share 
  } = require('@angular-architects/module-federation/webpack');

  module.exports = withModuleFederationPlugin({
    /*
    remotes: {
      products: 'http://localhost:3000/products.js',
    },
    */
    shared: share({
        '@angular/animations': {singleton: true, strictVersion: true},
        '@angular/core': {singleton: true, strictVersion: true},
        '@angular/common': {singleton: true, strictVersion: true},
        '@angular/forms': {singleton: true, strictVersion: true},
        '@angular/platform-browser': {singleton: true, strictVersion: true},
        '@angular/router': {singleton: true, strictVersion: true},
        'rxjs': {singleton: true, strictVersion: true, requiredVersion: false}
    })
  });
  ```

  Here, 
  - Remote module location can be configured in `remotes` section. This references the separately compiled and deployed MFE (`products`) project. But there is an alternative way which is shown in below section.

### Load remote modules/components
- Open the `Shell`'s router config (`app-routing.module.ts`) and add route for loading MFEs
  
  ```ts
  const routes: Routes = [
  {
    path: 'dashboard',
    loadChildren: () => loadRemoteModule({
      type: 'module',
      remoteEntry: 'http://localhost:3000/products.js',
      exposedModule: 'DashboardModule'
    }).then(m => m.DashboardModule)
  },
  {
    path: 'catalog',
    loadChildren: () => loadRemoteModule({
      type: 'module',
      remoteEntry: 'http://localhost:3000/products.js',
      exposedModule: 'CatalogModule'
    }).then(m => m.CatalogModule)
  }
  ];
  ```

### Run the projects
- Run MFE  
  `ng serve products`

- Run Host  
  `ng serve shell`

- Open the URL `http://localhost:4200/dashboard/dashboard` in browser. This should load the MFE into the shell. 